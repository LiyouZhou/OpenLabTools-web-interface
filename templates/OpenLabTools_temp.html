{% macro button(name, id, status_indicator = false) -%}
    <div class="button_container">
        {% if status_indicator %}
        <p id="{{ id }}-Status">Status:</p>
        {% endif %}

        <button type="button" id="{{ id }}" data-loading-text="Working..."
                class="btn btn-primary">{{name}}</button>
    </div>
    <script>
        $('#{{ id }}').click(
            function () {
                var btn = $(this);
                btn.button('loading');
                $.getJSON( "../button_click", { id: "{{ id }}" } )
                .done( function (json) {
                    console.log("State: " + json.state);
                    {% if status_indicator %}
                    $("#{{ id }}-Status").text("Status: " + json.state);
                    {% endif %}
                })
                .fail( function () {
                    alert("Request failed!")
                })
                .always( function () {
                    btn.button('reset');
                });
            });
    </script>
{%- endmacro %}


{% macro panel(name, id, sub_elem_dict) -%}

<div class="panel panel-default">
    <div class="panel-heading">
        <b>{{name}}</b>
    </div>
    <div class="panel-body">
        {% for key, item in sub_elem_dict.iteritems() if key != 'id' -%}
            {{key|debug}}
            {{ button( name=key, id=sub_elem_dict[key]['id'],  status_indicator = true) }}
        {%- endfor %}
    </div>
</div>
{%- endmacro %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <base href="static/" target="_blank">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script>
        <container>
        <title>OpenLabTools Web Interface</title>
        <style type="text/css">
            @media screen {
            .container {
                max-width: 730px;
                }
            }
            div.button_container{
                display: inline-block;
            }
        </style>
        <link rel="shortcut icon" href="http://www.cam.ac.uk/profiles/cam/themes/cam/assets/images/favicon.ico">
    </head>
    <body>
        <div class="container">
        <div class="page-header">
            <h1>OpenLabTools Web Interface</h1>
        </div>
        {% for key, value in config.iteritems() %}
        <p>{{ panel( key, config[key]['id'], config[key] ) }}</p>
        {%- endfor %}
        </div>
    </body>
</html>
